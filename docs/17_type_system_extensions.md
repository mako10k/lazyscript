# Type System Extensions（草案）

この文書は、第一級の無名構築子と名前空間型を導入するための型システム拡張案をまとめた草案です。議論のためのメモであり、実装の詳細は今後の検討に委ねます。

## 1. 無名構築子の第一級化

- 無名構築子は「型を入力として型を返す」写像として扱う。
- 型名は `#int` や `#str` などのビルトイン型、コンストラクタ名、任意の型識別子、型変数を使用できる。
- 既存の代数構築子は `arg1ty -> arg2ty -> ... -> a` というカリー化された型で表現し、`a` は任意のカインドを取り得る。
- 異なる無名構築子や引数から生成された型同士は同値とみなさない。

## 2. 名前空間の型表現

- 名前空間は「名前ごとに型を持つレコード型」として表現し、
  型評価時に利用可能なフィールドを引数から絞り込む。
- 将来的には条件付き UNION 型を導入し、引数やモジュール境界に応じたフィールド選択を可能にする。

## 3. 互換性と移行

- 現在存在する任意名・任意引数数のアドホック構築子は、当面は上記のカリー化された型にマッピングして扱う。
- 互換性の維持が難しい場合は、段階的に無名構築子への全面移行を検討する。

## 4. 今後の検討ポイント

- 型同値性の判定ルールと型エイリアスの扱い。
- 型推論アルゴリズムの拡張（高階型や条件付き UNION への対応）。
- 名前空間におけるフィールドアクセスの安全性と部分エクスポートの設計。

以上の案を基に、プロトタイプ実装やより詳細な型推論規則の設計を進めていく予定です。
