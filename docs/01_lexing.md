# 字句解析 (Lexing)

このドキュメントは lazyscript の字句仕様を示します。実装は `src/parser/lexer.l` にあり、Flex を用いて生成されます。

- コメント
  - 行コメント: `#` から行末まで無視
  - ブロックコメント: `{-` で開始し `-}` で終了。ネスト不可。
- 空白: スペース、タブ、改行は区切りとして無視
- 整数リテラル: 正の 10 進数 `[0-9]+` → トークン `LSTINT`
- シンボル: `[a-zA-Z_][a-zA-Z0-9_]*` → トークン `LSTSYMBOL`
- 単引用識別子（new）:
  - コンストラクタ名: `'Name'` → `LSTSYMBOL`（引用内で `\'`, `\\`, `\n`, `\t`, `\r`, `\xHH`, 8進などを解釈）
  - ドット付きシンボル: `.'name'` → `LSTSYMBOL`（先頭に `.` を付与して内部表現化）
  - 参照シンボル: `~'name'` → `LSTREFSYM`
  - 備考: いずれも終端の `'` までがトークン。従来の英数字識別子よりも先にマッチするよう字句規則の順序を配置。
- 文字列リテラル: `"..."`。`\` によるエスケープをサポート (`\"` など)。→ トークン `LSTSTR`
- 演算子・記号
  - `->` → トークン `LSTARROW`
  - `!IDENT` → トークン `LSTENVOP`（環境 API シュガー。例: `!require`, `!import`）
  - その他 1 文字記号はリテラル文字として返却 (例: `(`, `)`, `[`, `]`, `,`, `:`, `|`, `~`, `{`, `}`, `=`, `;` など)

位置情報: すべてのトークンで `YY_USER_ACTION` により `common/loc.h` の `lsloc_update` が呼ばれ、位置が更新されます。

メモリ管理: 生成コード内の `malloc/realloc/free` は GC ラッパ (`lsmalloc/lsrealloc/lsfree`) に置換されています。

注意: bash で `!{ ... }` や `!require` を `-e` で与える場合、ヒストリ展開に注意。シェル側でクォートして回避してください。
