# 最小タイプチェック（Core IR）

本機能は Core IR に対して最小限の型付けを行い、明白な誤用（過剰適用など）を検出します。
CLI フラグ `--typecheck` で利用できます。

- 成功時: `OK` を1行で出力、終了コード 0
- 失敗時: `E: type error` を1行で出力、終了コード 1

注意: 現時点では「最小版」です。将来的な拡張を前提に、以下の範囲に限定しています。

## いま扱う型の直感
- `int` / `str` / `unit`（`()`）
- `fun(n) -> R` のような「引数個数 n の関数（カリー化）」
  - 例: `add` / `sub` は `fun(2) -> int`
  - `chain` は `fun(2) -> unit`
  - `return` は `fun(1) -> unit`
  - ラムダ `\x -> ...` は `fun(1) -> unit` として扱います（最小版の簡易化）

## どのようにチェックするか（ざっくり）
- 値:
  - `Int`/`Str`/`()` はそれぞれの基本型
  - 既知の変数（`add`, `sub`, `chain`, `return`）は上記の関数型
  - 未知の識別子は `unit` として扱う（最小版の簡易化）
- 関数適用:
  - 関数の見込みが `fun(k) -> R` のとき、引数を `m` 個適用
    - `m > k` なら型エラー（過剰適用）
    - `m == k` なら結果型は `R`
    - `m < k` なら結果型は `fun(k-m) -> R`（部分適用）
- `if` は分岐の片方の型を返す（簡易化のため一致検査は未実装）
- 効果適用（EffApp）と `token` は `unit`
- `let` は束縛の型は使わずに本体の型を返す（最小版の簡易化）

## 使い方

```
# OK 例
./src/lazyscript --typecheck test/t01_add.ls
#=> OK

# エラー例（過剰適用）
./src/lazyscript --typecheck test/t14_type_arity_error.ls
#=> E: type error
```

## テスト
- `test/t01_add.type.out` … OK ケース
- `test/t14_type_arity_error.ls/.type.out` … エラー（過剰適用）

## 既知の制限（最小版）
- 引数や戻り値の型整合性チェックは行っていません（個数のみ）。
- `if` の分岐型一致、変数環境の追跡、ラムダの実際の型推論などは未対応。
- `println/exit` などはエフェクト適用（EffApp）経由で扱うため、型付けの対象外（常に `unit`）。

将来拡張の際は、Core IR の型式やシグネチャ環境を導入して段階的に厳密化する予定です。
